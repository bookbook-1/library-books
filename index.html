<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë„ì„œ ì „ì‹œíšŒ ì§„ë‹¨ ëª¨ë“œ</title>
    <style>
        body { font-family: 'Pretendard', sans-serif; background-color: #fdfaf5; padding: 20px; color: #333; }
        #debug-log { background: #eee; padding: 10px; border-radius: 5px; margin-bottom: 20px; font-size: 0.8rem; color: #d32f2f; border: 1px solid #ccc; }
        .gallery { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }
        .book-card { background: white; border-radius: 15px; padding: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); text-align: center; text-decoration: none; color: inherit; }
        .book-card img { width: 100%; height: 250px; object-fit: contain; border-radius: 8px; }
        .title { font-weight: bold; margin-top: 10px; }
    </style>
</head>
<body>

    <h1>ğŸ“š ë„ì„œ ì „ì‹œíšŒ (ì§„ë‹¨ ëª¨ë“œ)</h1>
    
    <div id="debug-log">ìƒíƒœ: ë°ì´í„° ë¡œë”© ì¤€ë¹„ ì¤‘...</div>

    <div id="book-gallery" class="gallery"></div>

    <script>
        const sheetCsvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQvgpFiJL5vGTUdZk3u_cnRyXeZ-Ej5u_FC3HihBMHtHs17ZBSObgQe6aWDH3UFIHpu0oKy1TYhcKPP/pub?gid=0&single=true&output=csv";

        function log(msg) {
            document.getElementById('debug-log').innerHTML += "<br>â–¶ " + msg;
        }

        async function loadBooks() {
            const gallery = document.getElementById('book-gallery');
            try {
                log("1. êµ¬ê¸€ ì‹œíŠ¸ì— ì—°ê²° ì‹œë„ ì¤‘...");
                const response = await fetch(sheetCsvUrl + "&t=" + new Date().getTime());
                
                if (!response.ok) throw new Error("ì‹œíŠ¸ ì£¼ì†Œê°€ ì˜ëª»ë˜ì—ˆê±°ë‚˜ ì ‘ê·¼ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.");
                
                const csvText = await response.text();
                log("2. ë°ì´í„°ë¥¼ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤. (ê¸€ì ìˆ˜: " + csvText.length + ")");

                const rows = csvText.split(/\r?\n/).filter(row => row.trim() !== "");
                log("3. ë¶„ì„ëœ ì¤„ ìˆ˜: " + rows.length + "ì¤„ (ì œëª© ì¤„ í¬í•¨)");

                if (rows.length <= 1) {
                    log("âš ï¸ ì˜¤ë¥˜: ì‹œíŠ¸ì— ì œëª© ì™¸ì— ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ì½”ë©ì„ ëŒë ¤ ë°ì´í„°ë¥¼ ì±„ì› ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.");
                    return;
                }

                gallery.innerHTML = ''; 

                for (let i = 1; i < rows.length; i++) {
                    const cols = rows[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                    
                    if (cols.length >= 5) {
                        const title = cols[0].replace(/"/g, "").trim();
                        const img = cols[4] ? cols[4].replace(/"/g, "").trim() : "";
                        const link = cols[5] ? cols[5].replace(/"/g, "").trim() : "#";

                        if (img.startsWith('http')) {
                            gallery.innerHTML += `
                                <div class="book-card">
                                    <img src="${img}" alt="${title}">
                                    <div class="title">${title}</div>
                                </div>`;
                        } else {
                            log("âš ï¸ " + i + "ë²ˆì§¸ ì¤„: ì´ë¯¸ì§€ ì£¼ì†Œê°€ ì—†ì–´ì„œ í‘œì‹œí•˜ì§€ ì•ŠìŒ (" + title + ")");
                        }
                    } else {
                        log("âš ï¸ " + i + "ë²ˆì§¸ ì¤„: ë°ì´í„° ì¹¸ì´ ë¶€ì¡±í•¨ (í˜„ì¬ " + cols.length + "ê°œ)");
                    }
                }

                log("âœ… ëª¨ë“  ë¶„ì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");

            } catch (e) { 
                log("âŒ ì—ëŸ¬ ë°œìƒ: " + e.message);
            }
        }
        loadBooks();
    </script>
</body>
</html>
